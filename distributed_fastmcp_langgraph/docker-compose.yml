version: '3.8'
services:
  orchestrator:
    build: .
    environment:
      - ORCHESTRATOR_HOST=http://orchestrator:8000
    ports:
      - "8000:8000"
    command: uvicorn orchestrator.app:app --host 0.0.0.0 --port 8000

  metadata_agent:
    build: .
    environment:
      - ORCHESTRATOR_REG_URL=http://orchestrator:8000/register
      - DATABRICKS_HOST=${DATABRICKS_HOST}
      - DATABRICKS_TOKEN=${DATABRICKS_TOKEN}
    command: uvicorn metadata_agent.app:app --host 0.0.0.0 --port 8101

  sql_agent:
    build: .
    environment:
      - ORCHESTRATOR_REG_URL=http://orchestrator:8000/register
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - AZURE_OPENAI_BASE=${AZURE_OPENAI_BASE}
      - AZURE_OPENAI_DEPLOYMENT=${AZURE_OPENAI_DEPLOYMENT}
    command: uvicorn sql_agent.app:app --host 0.0.0.0 --port 8102

  exec_agent:
    build: .
    environment:
      - ORCHESTRATOR_REG_URL=http://orchestrator:8000/register
      - DATABRICKS_SQL_SERVER_HOSTNAME=${DATABRICKS_SQL_SERVER_HOSTNAME}
      - DATABRICKS_SQL_HTTP_PATH=${DATABRICKS_SQL_HTTP_PATH}
      - DATABRICKS_TOKEN=${DATABRICKS_TOKEN}
    command: uvicorn exec_agent.app:app --host 0.0.0.0 --port 8103

  analyst_agent:
    build: .
    environment:
      - ORCHESTRATOR_REG_URL=http://orchestrator:8000/register
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - AZURE_OPENAI_BASE=${AZURE_OPENAI_BASE}
      - AZURE_OPENAI_DEPLOYMENT=${AZURE_OPENAI_DEPLOYMENT}
    command: uvicorn analyst_agent.app:app --host 0.0.0.0 --port 8104
